<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>HiPS client for Python : A GSoC project</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="HiPS client for Python : A GSoC project Atom Feed" />
        <link href="/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="HiPS client for Python : A GSoC project RSS Feed" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">HiPS client for Python : A GSoC project </a></h1>
                <nav><ul>
                    <li><a href="/category/astronomy.html">Astronomy</a></li>
                    <li><a href="/category/gsoc.html">GSoC</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/hips-tile-drawing.html">HiPS tile drawing</a></h1>
<footer class="post-info">
        <abbr class="published" title="2017-06-24T11:50:00">
                Sat 24 June 2017
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/adeel-ahmad.html">Adeel Ahmad</a>
        </address>
<p>In <a href="/category/gsoc.html">GSoC</a>. </p>

</footer><!-- /.post-info --><p>One of the major part of the <a href="http://hips.readthedocs.io">hips</a> project is being able to draw tiles onto a larger sky image. The most important part in this is using projective transformation for computing and drawing the tile at correct location. To achieve this, several steps are involved:</p>
<h3>Computing boundaries of a HiPS tile</h3>
<p>A tile is defined by four corners, <a href="http://hips.readthedocs.io">hips</a> contains a utility function named <a href="http://hips.readthedocs.io/en/latest/api/hips.utils.boundaries.html#hips.utils.boundaries">hips.utils.boundaries</a> which returns the angle (theta and phi) in radians. This contains the four corners of a HiPS tile in the order (North, West, South and East). A snippet which computes the corners of a HiPS tile is pasted below:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">hips.utils</span> <span class="kn">import</span> <span class="n">boundaries</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span> <span class="o">=</span> <span class="n">boundaries</span><span class="p">(</span><span class="n">nside</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">pix</span><span class="o">=</span><span class="mi">450</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">phi</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">theta</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;radian&#39;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s">&#39;icrs&#39;</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">SkyCoord</span> <span class="p">(</span><span class="n">ICRS</span><span class="p">):</span> <span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span> <span class="ow">in</span> <span class="n">deg</span>
<span class="p">[(</span> <span class="mf">264.375</span><span class="p">,</span> <span class="o">-</span><span class="mf">24.62431835</span><span class="p">),</span> <span class="p">(</span> <span class="mf">258.75</span> <span class="p">,</span> <span class="o">-</span><span class="mf">30.</span>        <span class="p">),</span>
 <span class="p">(</span> <span class="mf">264.375</span><span class="p">,</span> <span class="o">-</span><span class="mf">35.68533471</span><span class="p">),</span> <span class="p">(</span> <span class="mf">270.</span>   <span class="p">,</span> <span class="o">-</span><span class="mf">30.</span>        <span class="p">)]</span><span class="o">&gt;</span>
</pre></div>


<p>These are also referred to as HEALPix pixel corners. The returned values are in degrees which gives the latitude and longitude values in a list of tuples. The HiPS tile under discussion is shown below:</p>
<p><img alt="HiPS tile" src="/images/hips_tile.png" /></p>
<h3>Computing HEALPix pixel indices</h3>
<p>Another important step is to know the pixel indices which help us in computing the boundaries for all the tiles. For this, <a href="http://hips.readthedocs.io">hips</a> provides a <a href="http://hips.readthedocs.io/en/latest/api/hips.utils.compute_healpix_pixel_indices.html#hips.utils.compute_healpix_pixel_indices">hips.utils.compute_healpix_pixel_indices</a> function which takes in <a href="http://hips.readthedocs.io/en/latest/api/hips.utils.WCSGeometry.html#hips.utils.WCSGeometry">WCSGeometry</a> object and <code>nside</code> of the HEALPix map as parameter.</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">healpy</span> <span class="kn">as</span> <span class="nn">hp</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">hips.utils</span> <span class="kn">import</span> <span class="n">WCSGeometry</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">hips.utils</span> <span class="kn">import</span> <span class="n">compute_healpix_pixel_indices</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">skycoord</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&quot;deg&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wcs_geometry</span> <span class="o">=</span> <span class="n">WCSGeometry</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">skydir</span><span class="o">=</span><span class="n">skycoord</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
<span class="o">...</span>     <span class="n">coordsys</span><span class="o">=</span><span class="s">&#39;CEL&#39;</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s">&#39;AIT&#39;</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">cdelt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">crpix</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span>
<span class="o">...</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">nside</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">order2nside</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">compute_healpix_pixel_indices</span><span class="p">(</span><span class="n">wcs_geometry</span><span class="p">,</span> <span class="n">nside</span><span class="p">)</span>
<span class="n">array</span><span class="p">([</span><span class="mi">176</span><span class="p">,</span> <span class="mi">207</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">239</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">271</span><span class="p">,</span> <span class="mi">272</span><span class="p">])</span>
</pre></div>


<p>The output array values are used as an input to the <a href="http://hips.readthedocs.io/en/latest/api/hips.utils.boundaries.html#hips.utils.boundaries">boundaries</a> function's <code>pix</code> parameter.</p>
<h3>Applying projective transformation</h3>
<p>After the tile corners are computed, <a href="http://www.fen.bilkent.edu.tr/~franz/ag05/ag-07.pdf">projective transformation</a> is applied to the image. This takes in two parameters, source and destination. The destination array values are constant, since the <code>hips_tile_width</code> is always equal to <code>512</code>. The output is the transformed image which contains the HiPS tile drawn onto it.</p>
<div class="highlight"><pre><span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">all_sky</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">wcs</span><span class="o">.</span><span class="n">wcs_world2pix</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">511</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">511</span><span class="p">,</span> <span class="mi">511</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">511</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="n">tform3</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">ProjectiveTransform</span><span class="p">()</span>
<span class="n">tform3</span><span class="o">.</span><span class="n">estimate</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">output</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">warp</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">tform3</span><span class="p">,</span> <span class="n">output_shape</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>


<p>The resulting image is show below:</p>
<p><img alt="Projective transformation" src="/images/transform.png" /></p>
<p>The above image only shows a single tile drawn onto an empty all sky image. After the process is repeated for all the tiles, the result will be similar to this image:</p>
<p><img alt="All sky" src="{filename}/images/all_sky_scaled.png" /></p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/type-annotations-in-python-36-and-using-mypy-as-a-static-type-checker.html" rel="bookmark"
                           title="Permalink to Type annotations in Python 3.6 and using Mypy as a static type checker">Type annotations in Python 3.6 and using Mypy as a static type checker</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-06-11T12:58:00">
                Sun 11 June 2017
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/adeel-ahmad.html">Adeel Ahmad</a>
        </address>
<p>In <a href="/category/gsoc.html">GSoC</a>. </p>

</footer><!-- /.post-info -->                <p>The main goal of type annotations is to open up Python code to easier static analysis and refactoring, potential runtime type checking, and (perhaps, in some contexts) code generation utilizing type information. These were introduced in <a href="https://www.python.org/dev/peps/pep-0484/">PEP 484</a>.</p>
<p>In this regards, static type checking is the most important. It allows ...</p>
                <a class="readmore" href="/type-annotations-in-python-36-and-using-mypy-as-a-static-type-checker.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/an-overview-of-hierarchical-progressive-surveys-hips-and-the-healpix-framework.html" rel="bookmark"
                           title="Permalink to An overview of Hierarchical Progressive Surveys (HiPS) and the HEALPix framework">An overview of Hierarchical Progressive Surveys (HiPS) and the HEALPix framework</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-05-31T19:39:00">
                Wed 31 May 2017
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/adeel-ahmad.html">Adeel Ahmad</a>
        </address>
<p>In <a href="/category/gsoc.html">GSoC</a>. </p>

</footer><!-- /.post-info -->                <p>HiPS utilizes the HEALPix framework and uses it for mapping a sphere (in this case, part of a sky) and compiles / transforms it into <a href="#hips-tiles">tiles</a> and <a href="#hips-pixels">pixels</a>. Of course, this is in context of astronomical data. HiPS emphasizes on usability thus it tries abstract the scientific details while preserving them ...</p>
                <a class="readmore" href="/an-overview-of-hierarchical-progressive-surveys-hips-and-the-healpix-framework.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/an-introduction-to-coordinate-systems-used-in-astronomy.html" rel="bookmark"
                           title="Permalink to An introduction to coordinate systems used in astronomy">An introduction to coordinate systems used in astronomy</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-05-23T12:37:00">
                Tue 23 May 2017
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/adeel-ahmad.html">Adeel Ahmad</a>
        </address>
<p>In <a href="/category/astronomy.html">Astronomy</a>. </p>

</footer><!-- /.post-info -->                <p>Before moving on to the coordinate systems, listed below are some common measures used in astronomical studies.</p>
<h3><strong>RA / DEC</strong></h3>
<p>RA (right ascension) and DEC (declination) are the longitudes and latitudes of the sky. RA corresponds to east/west direction (like longitude), while Dec measures north/south directions, like latitude.</p>
<h3><strong>WCS ...</strong></h3>
                <a class="readmore" href="/an-introduction-to-coordinate-systems-used-in-astronomy.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/a-comparison-of-response-times-using-urllib-grequests-and-asyncio.html" rel="bookmark"
                           title="Permalink to A comparison of response times using URLLib, GRequests, and asyncio">A comparison of response times using URLLib, GRequests, and asyncio</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-05-09T15:54:00">
                Tue 09 May 2017
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/adeel-ahmad.html">Adeel Ahmad</a>
        </address>
<p>In <a href="/category/gsoc.html">GSoC</a>. </p>

</footer><!-- /.post-info -->                <p>For the HiPS client as multiple tiles have to be fetched for time efficiency, concurrency has to be achieved. So, a comparison was done utilizing Python's <code>threading</code> library. The elapsed time was calculated using <code>time</code>. For fetching the tiles <code>urllib</code>, <code>grequests</code>, <code>aiohttp</code>, <code>asyncio</code> were used. The survey chosen was ...</p>
                <a class="readmore" href="/a-comparison-of-response-times-using-urllib-grequests-and-asyncio.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/my-first-article.html" rel="bookmark"
                           title="Permalink to My First Article">My First Article</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-03-19T22:45:00">
                Sun 19 March 2017
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/adeel-ahmad.html">Adeel Ahmad</a>
        </address>
<p>In <a href="/category/gsoc.html">GSoC</a>. </p>

</footer><!-- /.post-info -->                <p>Hello World!</p>
<p>This blog will be extensively used for posting GSoC updates, apart from other technical ramblings.</p>
                <a class="readmore" href="/my-first-article.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://openastronomy.org/">Open Astronomy</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            <li><a href="/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">rss feed</a></li>

                            <li><a href="https://twitter.com/adl1995">Twitter</a></li>
                            <li><a href="http://github.com/adl1995">GitHub</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>