<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Creating custom decorators in Python 3.6</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="HiPS client for Python : A GSoC project Atom Feed" />
        <link href="/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="HiPS client for Python : A GSoC project RSS Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">HiPS client for Python : A GSoC project </a></h1>
                <nav><ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/category/astronomy.html">Astronomy</a></li>
                    <li><a href="/category/gsoc.html">GSoC</a></li>
                    <li><a href="/archives.html">Archives</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/creating-custom-decorators-in-python-36.html" rel="bookmark"
           title="Permalink to Creating custom decorators in Python 3.6">Creating custom decorators in Python&nbsp;3.6</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-07-02T12:41:00+05:00">
                Published: Sun 02 July 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/adeel-ahmad.html">Adeel Ahmad</a>
        </address>
<p>In <a href="/category/gsoc.html">GSoC</a>.</p>

</footer><!-- /.post-info -->      <p>In the <a href="http://hips.readthedocs.io">hips</a> package, often data has to be fetched from remote servers, especially HiPS tiles. One way to cut back on the queries was by introducing the <a href="github.com/hipspy/hips-extra">hips-extra</a> repository. This contains HiPS tiles from various HiPS surveys. This allows us to quickly fetch tiles from local storage, which makes the testing process less&nbsp;time-consuming.</p>
<p>As <a href="github.com/hipspy/hips-extra">hips-extra</a> repository does not come with the standard <a href="http://hips.readthedocs.io">hips</a> package, user has to manually clone it. The availability of the package is checked using an environment variable. This can be set&nbsp;using:</p>
<div class="highlight"><pre><span></span><span class="nv">$export</span> <span class="nv">HIPS_EXTRA</span><span class="o">=</span><span class="se">\p</span>ath<span class="se">\t</span>o<span class="se">\h</span>ips-extra
</pre></div>


<p>In Python, the path can be retrieved using the <code>os</code> module: <code>os.environ['HIPS_EXTRA']</code>. Now, what if the user does not have <a href="github.com/hipspy/hips-extra">hips-extra</a> repository on their system. In this case, we don&#8217;t want to raise any errors, but to simply skip the test case. In order to do this, Python decorators become&nbsp;useful.</p>
<h3>A brief overview on Python&nbsp;Decorators</h3>
<p>Decorators provide a simple syntax for calling higher-order functions. By definition, a decorator is a function that takes another function and extends the behavior of the latter function without explicitly modifying it. Some of the most commonly used decorators are <code>@classmethod</code>, <code>@staticmethod</code>, <code>@property</code>, etc. The decorators are written above a function header, like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</pre></div>


<h3>Writing your own&nbsp;decorators</h3>
<p>To write our decorators, we create a wrapper function around <code>pytest.mark.skipif</code>. The <a href="https://docs.pytest.org/en/latest/skipping.html#id1">documentation</a> of this function can be viewed to get detailed information on how it works. The function below checks if the <code>HIPS_EXTRA</code> environment variable is set on the user&#8217;s system, and if it is, it returns a True boolean&nbsp;. </p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="k">def</span> <span class="nf">has_hips_extra</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Is hips-extra available? (`bool`)&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;HIPS_EXTRA&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HIPS_EXTRA&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="s1">&#39;datasets/samples/DSS2Red/properties&#39;</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>
</pre></div>


<p>A separate function below makes use of the above function to check whether the package is available or&nbsp;not:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>

<span class="k">def</span> <span class="nf">requires_hips_extra</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Decorator to mark tests requiring ``hips-extra`` data.&quot;&quot;&quot;</span>
    <span class="n">skip_it</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">has_hips_extra</span><span class="p">()</span>
    <span class="n">reason</span> <span class="o">=</span> <span class="s1">&#39;No hips-extra data available.&#39;</span>
    <span class="k">return</span> <span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipif</span><span class="p">(</span><span class="n">skip_it</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="n">reason</span><span class="p">)</span>
</pre></div>


<p>This decorator can now be used. An example illustrating its use is shown below. First we import the function from its location and then apply it to another function that uses data from <a href="github.com/hipspy/hips-extra">hips-extra</a>&nbsp;repository:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hips.utils.testing</span> <span class="kn">import</span> <span class="n">requires_hips_extra</span>

<span class="nd">@requires_hips_extra</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_draw_sky_image</span><span class="p">():</span>
    <span class="o">...</span>
</pre></div>


<p>If the user&#8217;s <code>HIPS_EXTRA</code>  environment variable does not have a valid path, the above test will be&nbsp;skipped.</p>
      	<style>
#pcs-comment-form input,
#pcs-comment-form textarea {
	width: 100%;
}
#pcs-comment-form-display-replyto {
	border: solid 1px black;
	padding: 2px;
}
#pcs-comment-form-display-replyto p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}
#pcs-comments ul {
	list-style: none;
}
#pcs-comments .comment-left {
	display: table-cell;
	padding-right: 10px;
}
#pcs-comments .comment-body {
	display: table-cell;
	vertical-align: top;
	width: 100%;
}
</style>

	<section id="pcs-comments">
	<header>
		<h2>Comments</h2>
		<hr/>
	</header>
		<p>There are no comments yet.</p>
	<section>
	<form id="pcs-comment-form" action="#">
		<legend>Add a Comment</legend>
		<input type="hidden" id="pcs-comment-form-input-replyto">
		<fieldset>
			<label for="pcs-comment-form-input-name">Name</label>
			<input  id="pcs-comment-form-input-name" type="text" placeholder="Enter your name or nickname" />
		</fieldset>
		<fieldset>
			<label for="pcs-comment-form-input-website">Website</label>
			<input  id="pcs-comment-form-input-website" type="text" placeholder="Enter your website (optional)" />
		</fieldset>
		<fieldset>
			<label   for="pcs-comment-form-input-textarea">Your Comment</label>
			<textarea id="pcs-comment-form-input-textarea" rows="5" style="resize:vertical;" placeholder="Your comment"></textarea>
			<p>You can use the <a href="https://en.wikipedia.org/wiki/Markdown">Markdown</a> syntax to format your comment.</p>
			<div style="display: none; " id="pcs-comment-form-display-replyto"></div>
		</fieldset>

		<button type="submit"
				id="pcs-comment-form-button-submit"
				>Post via email</button>

			<a href="/feeds/comment.creating-custom-decorators-in-python-36.atom.xml">
				Comment Atom Feed
			</a>
	</form>
</section>

</section>

			<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
	<script type="text/javascript" src="/theme/js/comments.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			CommentSystem.email_user   = "adeelahmad14";
			CommentSystem.email_domain = "hotmail.com";
			CommentSystem.display_replyto_html = function(comment_content, article_slug, author) { 
				return ''
					+ '<button style="float:right;" onclick="CommentSystem.cancelReply(); return false;" title="Cancel the reply">'
					+ 	'×'
					+ '</button>'
					+ '<p>This comment will be posted as a reply to \'<a title="'+comment_content+'" href="#comment-'+article_slug+'">'+author+'</a>\'</p>';
			};

			$('#pcs-comment-form').on("submit",
				function( event )
				{
					event.preventDefault();
					$(location).attr('href', CommentSystem.getMailtoLink("creating-custom-decorators-in-python-36"));
				}
			);
		});
	</script>


    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://openastronomy.org/">Open Astronomy</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            <li><a href="/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">rss feed</a></li>

                            <li><a href="https://twitter.com/adl1995">Twitter</a></li>
                            <li><a href="http://github.com/adl1995">GitHub</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>