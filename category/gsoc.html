<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>HiPS client for Python : A GSoC project - GSoC</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="HiPS client for Python : A GSoC project Atom Feed" />
        <link href="/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="HiPS client for Python : A GSoC project RSS Feed" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">HiPS client for Python : A GSoC project </a></h1>
                <nav><ul>
                    <li><a href="/category/astronomy.html">Astronomy</a></li>
                    <li class="active"><a href="/category/gsoc.html">GSoC</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/fixing-tile-distortion-issue-in-hips-package.html">Fixing tile distortion issue in hips package</a></h1>
<footer class="post-info">
        <abbr class="published" title="2017-08-10T11:28:00">
                Thu 10 August 2017
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/adeel-ahmad.html">Adeel Ahmad</a>
        </address>
<p>In <a href="/category/gsoc.html">GSoC</a>. </p>

</footer><!-- /.post-info --><p>As documented in the <a href="http://hips.readthedocs.io/en/latest/drawing_algo.html#tile-distortion-issue">Tile distortion issue</a> section, the previous technique for drawing HiPS tiles brings some astrometry offsets for distorted tiles.</p>
<p>An example of such distortions is shown in the example below (uncheck "Activate deformations reduction algorithm" to view the astrometry offsets): <a href="http://cds.unistra.fr/~boch/AL/test-reduce-deformations2.html">http://cds.unistra.fr/~boch/AL/test-reduce-deformations2.html</a></p>
<p>To overcome this issue, the parent tile is divided into four children tiles if it meets the following two conditions:</p>
<ul>
<li>One edge is greater than 300 pixels when projected</li>
<li>Or, the ratio of smaller diagonal on larger diagonal is smaller than 0.7 and one of the diagonal is greater than 150 pixels when projected</li>
</ul>
<p>For handling these checks, a function named <code>is_tile_distorted</code> was introduced:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">is_tile_distorted</span><span class="p">(</span><span class="n">corners</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Is the tile with the given corners distorted?&quot;&quot;&quot;</span>
    <span class="n">edges</span><span class="p">,</span> <span class="n">diagonals</span> <span class="o">=</span> <span class="n">measure_tile_lengths</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
    <span class="n">diagonal_ratio</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">diagonals</span><span class="p">)</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">diagonals</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span>
        <span class="nb">max</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">300</span> <span class="ow">or</span>
        <span class="nb">max</span><span class="p">(</span><span class="n">diagonals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">150</span> <span class="ow">or</span>
        <span class="n">diagonal_ratio</span> <span class="o">&lt;</span> <span class="mf">0.7</span>
    <span class="p">)</span>
</pre></div>


<p>The <code>measure_tile_lengths</code> function computes the length of tile edges and diagonals by computing the euclidean distance between two points, its source code can be found <a href="https://github.com/hipspy/hips/blob/master/hips/draw/paint.py#L223">here</a>.</p>
<p>If a tile passes all the above checks, it is then split into four children tiles, which is achieved by the following property:</p>
<div class="highlight"><pre><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s">&#39;HipsTile&#39;</span><span class="p">]:</span>
<span class="sd">&quot;&quot;&quot;Create four children tiles from parent tile.&quot;&quot;&quot;</span>
<span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">w</span><span class="p">:</span> <span class="n">w</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="n">w</span><span class="p">],</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="n">w</span><span class="p">],</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">w</span><span class="p">:</span> <span class="n">w</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="n">w</span> <span class="o">*</span> <span class="mi">2</span><span class="p">],</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">w</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="n">w</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">tiles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="n">meta</span> <span class="o">=</span> <span class="n">HipsTileMeta</span><span class="p">(</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">ipix</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">idx</span><span class="p">,</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">file_format</span><span class="p">,</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
   <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">tile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
<span class="n">tiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tile</span><span class="p">)</span>

<span class="k">return</span> <span class="n">tiles</span>
</pre></div>


<p>The criteria for choosing the HiPS order and ipix for children tiles is mentioned in the <a href="http://www.ivoa.net/documents/HiPS/20160623/WD-HiPS-1.0-20160623.pdf">HiPS IVOA paper</a>, Appendix, page 31.</p>
<p>A Jupyter notebook illustrating this functionality can be found <a href="https://github.com/adl1995/HIPS-to-Py/blob/master/examples/Precise%20drawing-ICRS.ipynb">here</a>. Currently there is no recursion involved in tile splitting, so the parent tile is split only once. Therefore, the results can be improved further, a side-by-side comparison is shown using a GIF image:</p>
<p><img alt="Precise and simple drawing" src="/images/precise-simple-gamma.gif" /></p>
<p>The red line connects five stars, of which the middle one is the Gamma Cassiopeiae. This can be used to verfiy if the image is drawn correctly, by looking at the corner positions and confirming if they align correctly with the stars.</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/rgb-tile-drawing-in-hips-package.html" rel="bookmark"
                           title="Permalink to RGB tile drawing in hips package">RGB tile drawing in hips package</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-07-23T12:46:00">
                Sun 23 July 2017
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/adeel-ahmad.html">Adeel Ahmad</a>
        </address>
<p>In <a href="/category/gsoc.html">GSoC</a>. </p>

</footer><!-- /.post-info -->                <p>The <code>hips</code> package now supports RGB tile drawing. To make this possible, the output image dimensions had to be altered according to the following configuration:</p>
<p>The output image shape is two dimensional for grayscale, and three dimensional for color images:</p>
<ul>
<li><code>shape = (height, width)</code> for FITS images with one grayscale channel ...</li></ul>
                <a class="readmore" href="/rgb-tile-drawing-in-hips-package.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/parameterized-testing-using-pytest.html" rel="bookmark"
                           title="Permalink to Parameterized testing using Pytest">Parameterized testing using Pytest</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-07-13T09:40:00">
                Thu 13 July 2017
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/adeel-ahmad.html">Adeel Ahmad</a>
        </address>
<p>In <a href="/category/gsoc.html">GSoC</a>. </p>

</footer><!-- /.post-info -->                <p>Pytest provides a feature for parameterized testing in Python. The built-in <code>pytest.mark.parametrize</code> decorator enables parametrization of arguments for a test function. This allows the user to compare the values for input and output.</p>
<p>Here is a typical example which shows its usage:</p>
<div class="highlight"><pre><span class="n">get_hips_order_for_resolution_pars</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">tile_width</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mf">0 ...</span></pre></div>
                <a class="readmore" href="/parameterized-testing-using-pytest.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/creating-custom-decorators-in-python-36.html" rel="bookmark"
                           title="Permalink to Creating custom decorators in Python 3.6">Creating custom decorators in Python 3.6</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-07-02T12:41:00">
                Sun 02 July 2017
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/adeel-ahmad.html">Adeel Ahmad</a>
        </address>
<p>In <a href="/category/gsoc.html">GSoC</a>. </p>

</footer><!-- /.post-info -->                <p>In the <a href="http://hips.readthedocs.io">hips</a> package, often data has to be fetched from remote servers, especially HiPS tiles. One way to cut back on the queries was by introducing the <a href="github.com/hipspy/hips-extra">hips-extra</a> repository. This contains HiPS tiles from various HiPS surveys. This allows us to quickly fetch tiles from local storage, which makes ...</p>
                <a class="readmore" href="/creating-custom-decorators-in-python-36.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/hips-tile-drawing.html" rel="bookmark"
                           title="Permalink to HiPS tile drawing">HiPS tile drawing</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-06-24T11:50:00">
                Sat 24 June 2017
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/adeel-ahmad.html">Adeel Ahmad</a>
        </address>
<p>In <a href="/category/gsoc.html">GSoC</a>. </p>

</footer><!-- /.post-info -->                <p>One of the major part of the <a href="http://hips.readthedocs.io">hips</a> project is being able to draw HiPS tiles onto a larger sky image. The most important part in this is using projective transformation for computing and drawing a HiPS tile at the correct location. The discussion below is for the tile containing ...</p>
                <a class="readmore" href="/hips-tile-drawing.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/type-annotations-in-python-36-and-using-mypy-as-a-static-type-checker.html" rel="bookmark"
                           title="Permalink to Type annotations in Python 3.6 and using Mypy as a static type checker">Type annotations in Python 3.6 and using Mypy as a static type checker</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-06-11T12:58:00">
                Sun 11 June 2017
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/adeel-ahmad.html">Adeel Ahmad</a>
        </address>
<p>In <a href="/category/gsoc.html">GSoC</a>. </p>

</footer><!-- /.post-info -->                <p>The main goal of type annotations is to open up Python code to easier static analysis and refactoring, potential runtime type checking, and (perhaps, in some contexts) code generation utilizing type information. These were introduced in <a href="https://www.python.org/dev/peps/pep-0484/">PEP 484</a>.</p>
<p>In this regards, static type checking is the most important. It allows ...</p>
                <a class="readmore" href="/type-annotations-in-python-36-and-using-mypy-as-a-static-type-checker.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/an-overview-of-hierarchical-progressive-surveys-hips-and-the-healpix-framework.html" rel="bookmark"
                           title="Permalink to An overview of Hierarchical Progressive Surveys (HiPS) and the HEALPix framework">An overview of Hierarchical Progressive Surveys (HiPS) and the HEALPix framework</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-05-31T19:39:00">
                Wed 31 May 2017
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/adeel-ahmad.html">Adeel Ahmad</a>
        </address>
<p>In <a href="/category/gsoc.html">GSoC</a>. </p>

</footer><!-- /.post-info -->                <p>HiPS utilizes the HEALPix framework and uses it for mapping a sphere (in this case, part of a sky) and compiles / transforms it into <a href="#hips-tiles">tiles</a> and <a href="#hips-pixels">pixels</a>. Of course, this is in context of astronomical data. HiPS emphasizes on usability thus it tries abstract the scientific details while preserving them ...</p>
                <a class="readmore" href="/an-overview-of-hierarchical-progressive-surveys-hips-and-the-healpix-framework.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/a-comparison-of-response-times-using-urllib-grequests-and-asyncio.html" rel="bookmark"
                           title="Permalink to A comparison of response times using URLLib, GRequests, and asyncio">A comparison of response times using URLLib, GRequests, and asyncio</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-05-09T15:54:00">
                Tue 09 May 2017
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/adeel-ahmad.html">Adeel Ahmad</a>
        </address>
<p>In <a href="/category/gsoc.html">GSoC</a>. </p>

</footer><!-- /.post-info -->                <p>For the HiPS client as multiple tiles have to be fetched for time efficiency, concurrency has to be achieved. So, a comparison was done utilizing Python's <code>threading</code> library. The elapsed time was calculated using <code>time</code>. For fetching the tiles <code>urllib</code>, <code>grequests</code>, <code>aiohttp</code>, <code>asyncio</code> were used. The survey chosen was ...</p>
                <a class="readmore" href="/a-comparison-of-response-times-using-urllib-grequests-and-asyncio.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/my-first-article.html" rel="bookmark"
                           title="Permalink to My First Article">My First Article</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-03-19T22:45:00">
                Sun 19 March 2017
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/adeel-ahmad.html">Adeel Ahmad</a>
        </address>
<p>In <a href="/category/gsoc.html">GSoC</a>. </p>

</footer><!-- /.post-info -->                <p>Hello World!</p>
<p>This blog will be extensively used for posting GSoC updates, apart from other technical ramblings.</p>
                <a class="readmore" href="/my-first-article.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://openastronomy.org/">Open Astronomy</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            <li><a href="/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">rss feed</a></li>

                            <li><a href="https://twitter.com/adl1995">Twitter</a></li>
                            <li><a href="http://github.com/adl1995">GitHub</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>